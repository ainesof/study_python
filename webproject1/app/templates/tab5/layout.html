<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    {% extends 'base_etc.html' %}
    {% block content %}
<script>

schdule_status='close';
checkbtn_status='close';


$(function () {

        setInterval('btn_time()', 1000);

});

function btn_click(){
<!-- 스케쥴러 기능 ON/OFF -->
    if(schdule_status=='close'){    schdule_status='open';  }
    else{
        schdule_status='close';
        $('#do_scheduler').html('스케쥴러 중지');}
}

function btn_time(){
<!-- 24시간 기준 00:00형식 -->
    const task=[['15:02','test1()'],
                ['15:16','test2()'],
                ['14:56','getfile()']];

    if(schdule_status=='open'){
        var nowHour = String(new Date().getHours()).padStart(2,'0');
        var nowMin = String(new Date().getMinutes()).padStart(2,'0');
        var nowSec = String(new Date().getSeconds()).padStart(2,'0');
        var nowtime = nowHour + ":" + nowMin;
        $('#do_scheduler').html('스케쥴러 '+nowtime+ ":" + nowSec);

        if(nowSec=='00'){
            for(var i=0;i<task.length;i++){
                if(task[i][0]==nowtime) eval(task[i][1]);
            }
        }
    }
}

function test1(){ alert('111') }
function test2(){ alert('222') }


function checkdata(){
<!-- 테이블 자료가 하나쪽 자료와 맞는지 체크용 -->
        if(checkbtn_status=='close'){
            var check='';
<!--            var text_data = ['가','나']; -->
            $.ajax({
                    url : {{ url_for('tab5.callAjax')}}
                    ,type : 'POST'
                    ,dataType : 'json'
                    ,traditional : true
<!--                    ,data : {sendMSG: JSON.stringify(text_data)} -->

            })
            .done(function(value){
                for(var i=0;i<value.length;i++){
                    if(value[i][3]!='True'){
                    check+=value[i][1]+" ";
                    }
                }
                if(check==''){
                    $('#paritycheck').html('이상 없음');
                }
                else{
                    $('#paritycheck').html('펀드번호: '+check);
                }

                for(var i=0;i<value.length;i++){
                    for(var j=0;j<value[0].length;j++){
                        $('[name='+i+'-'+j+']').html(value[i][j]);
                    }
                }
                checkbtn_status='open';
            });
        }
         else if(checkbtn_status='open'){
         $('#paritycheck').html('테이블값 검증');
         checkbtn_status='close';
         }
}

function getfile(){
<!-- 한국펀드평가 파일 받음 -->
    $('#getfile').attr('disabled',true);
    $('#getfile').html('다운로드 중');

    $.ajax({
        url : {{ url_for('tab5.getfile')}}
        ,type: 'post'
<!--        ,dataType: 'JSON' -->
<!--        ,traditional: true -->
    })
    .done(function() {
        $('#getfile').attr('disabled',false);
        $('#getfile').html('파일 가져오기');
    });
}

</script>
</head>
<body>
<div class="btn-group btn-group-lg" role="group" aria-label="...">
    <button type="button" class="btn btn-outline-secondary" name="menu1"/>
    <button type="button" class="btn btn-outline-secondary" name="menu2"/>
    <button type="button" class="btn btn-outline-secondary" name="menu3"/>
    <button type="button" class="btn btn-outline-secondary" name="menu4"/>
    <button type="button" class="btn btn-outline-secondary" name="menu5"/>
</div>
<br><br>

<ul class="list-group">
  <li class="list-group-item active"> 레이아웃 구성</li>
  <li class="list-group-item">1-1고객 그룹별 수탁고 총괄->1-2고객 그룹별 순자산/설정액 현황(본부/그룹+고객)->1-3펀드리스트</li>
  <li class="list-group-item">2-1고객 유형별 수탁고 총괄->2-2고객 유형별 순자산/설정액 현황(본부/유형+그룹)->2-3펀드리스트</li>
  <li class="list-group-item">99-1다이렉트 수익자정보 검색(새창)->99-2다이렉트 수익자정보</li>
</ul>


<div style="margin:10px;">
<!-- Javascript가 필요없이 data-toggle에 collapse href에 대상 id을 설정합니다. -->
<button id="paritycheck" class="btn btn-primary" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample" onclick="checkdata()">테이블값 검증</button>
<button id="getfile" class="btn btn-primary" onclick="getfile()">파일 가져오기</button>
<button id="do_scheduler" class="btn btn-primary" onclick="btn_click()">스케쥴러 중지</button>
</div>


<!-- collapse 대상 태그는 class를 collapse로 설정합니다. -->
<div class="collapse" id="collapseExample">
    <div class="well">
        <table class="table table-striped table-bordered table-hover" id="tab5_table" >
            <thead>
                <tr class="thead-dark" align="center">
                    <th>No.</th>
                    <th>펀드번호</th>
                    <th>설정액</th>
                    <th>금액 비교</th>
                </tr>
            </thead>
            <tbody align="center">
                {% for i in range(queryData1|count) %}
                    <tr>
                        {% for j in range(4) %}
                            <td name={{i}}-{{j}}></td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

</body>
</html>